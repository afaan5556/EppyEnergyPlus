# EppyEnergyPlus




## Introduction

* This script could run EnergyPlus parametrically with Eppy package( [Eppy tutorial link](https://pythonhosted.org/eppy/Main_Tutorial.html)), generating new IDF files with different orientations in folder "idfs".

* This script also solves problems when automatically deploying one building IDF model to a large amount of different locations with loops of replacing the ddy information in IDFs and attaching epw files to run.

* Information in ddy file is extracted and used to replace the "sizing period" part in IDF files with Regex package([Regex Doc](https://docs.python.org/3/library/re.html)), with the same blocks as are inserted in OpenStudio.

* The locations need to run (weather file names without extensions) are listed in the WeatherFileNameList.csv file . This csv file could be written by reading the weather file name list in the weather directory with function "WriteEPWNameToCSV" or manually edited by entering the weather file name.

* At this stage, this script is used for load calculation, so the "Ideal Air Load" model is used, which requires expand object file to run. Therefore, the "expandobjects" has to be set "True" when calling the run() function in eppy

* "Zone Component Load Summary Report" is generated (defined in initial IDF file) to see the load result, and some script is written for parsing the total load number (sensible+ latent).
**Note: if the IDF "Output:Table:SummaryReports" is not defined to generate "Zone Component Load Summary" report, then this part of script is not gonna work**

* After getting the peak load, system sizing is done and unitary systems are added for each thermal zone for a specific project. The HVAC part is generated according to an HVAC library idf file which contains all blocks included in a unitary system. This library file could be generated by comparing file with and without system using some part of codes in the scripts but might need to delete the repetitive blocks.

* Before inserting the HVAC part, the ideal air loads tempelate part is removed

* Node numbers in the intial IDF file are detected to avoid node overlapping error(if there're water systems built in the initial IDF)


### Variables and Paths

* The initial idf model is needed for energy simulation in different locations and generating new models parametrically.

* The paths to weather files (epw format and ddy format) are needed to deploy the building model to different locations.

* The path to the project directory is needed

* A library of air ideal loads and HVAC system blocks are needed (or two models with air ideal loads and with target HVAC system are needed for generating these libraries)

* EnergyPlus idd file is needed

* A .csv file is needed for parametric location simulation (Or generated from reading the file names in weather dir)

* Other dir and files would generated automatically by running the scripts



### Functions


#### packblocks(ddypath):

    This function helps pack up text files into blocks by recognizing blank lines as separations
	
    :param ddypath: This is the path to the directory where the text files are located
	
    :return: This function returns the lists of blocks which are lists of lines in text files



#### pickupblocks(packedlist, tar):

    This function has to be called after packddy function with an arguement of ddy block list, and this function is to pick up the blocks by a special string in the block

    :param packedlist: This is the packed ddy list with different blocks

    :param tar: This is a special string to recognize the target block

    :return: This function returns a dictionary of the picked block in which the key is the statement in ddy file after "!-"



#### updatesite(packedlist, idf):

    This function updates the site:Location information in idf file with that in ddy file, this function has to be called after packddy function with an argument of packed ddy list

    :param packedlist: This is the packed ddy list with different blocks

    :param idf: The initial input idf file

    :return: This function returns the site:location part updated idf file



#### updateddyitem(DP0, sizingperiod):

    This is the process function called by UpdateLocationInfinIDF function which updates each block of design day information

    :param DP0: This is the design period block picked from ddy file

    :param sizingperiod: This is the corresponding block in idf file

    :return: This function returns the updated block in IDF



#### UpdateLocationInfinIDF(idf1,ddyname):

    This function Automatically updates the location information as well as the design period information in an idf file

    :param idf1: the input idf file which needs to update the design day data and site information

    :param ddyname: This is the path to the directory in which the ddy files are located (relative to the working dir)

    :return: This function returns the updated idf file



### WriteEPWNameToCSV(WeatherPath, CsvPath, i):

    This function automatically writes the csv file with weather file names by reading the name list in the directory where these files stored.

    :param WeatherPath: This is the path to the directory where the weather files are stored

    :param CsvPath: This is the path to the .csv file

    :param i: This is the number of weather files written into the csv file in the loop

    :return: This function returns nothing



### ReadFileNameInCsv(dir):

    This function reads the file names stored in a .csv file

    :param dir: This is the path to the directory in which the csv files are located (relative to the working directory)

    :return: A list object in which each element is a file name as a string



###ReadHVACdesignLoads(resultsdir):
	
	This function is used to read the HVAC peak load results from ZoneComponentSummary Report generated from the AirIdealLoads simulation
	
    :param resultsdir : This is the directory where the results for the first simulation are stored 
	
    :return: This function returns a dictionary with zonenames, heating peak loads, and cooling peak loads
	
	
	
###compare_two_IDF(file1, file2, resultdir)

    This function is used to compare two idf files and generating the unique part in the first file regardless of the name differences 
	
	(Notice: there might be some blocks whose parameters all contain 'Name', which might be skipped in this function.)
	
    :param file1: This is the first idf file to compare
	
    :param file2: This is the second idf file to compare
	
    :param resultdir: This is the directory to store the unique part generated
	
    :return: This function returns nothing
	
	
	
###pickupHVACsystem(idfHVACfile, idfObject,zoneloadlist, NodeNumb)

    This function is used for generating the idf HVAC objects, the sizes of HVAC system need to be modified for each project
	
    :param idfHVACfile: This is the HVAC library idf file
	
    :param idfObject: This is the idf object used for zone number calculation
	
    :param zoneloadlist:This is the dictionary contains the peak load information
	
    :param NodeNumb: This is the node number to start building HVAC systems
	
    :return: This function returns the HVAC idf objects built for specific projects
	
	
	
###createFolder(directory)

    This function is used to generate directory if it's not existed.
	
    :param directory: This is the directory to generate
	
    :return: This function returns nothing
	
	
	
###SearchNode(idfpath)

    This function is used to detect the existing nodes in initial idf files, and help define the start node number to build HVAC system
	
    :param idfpath: This is the path to the initial idf file
	
    :return: This funciton returns the maximum node number in existing system( usually water system) to start building HVAC system nodes.
	
	
	
###RemoveIdealPart(IdealIDF,IdealPartIDF, fname )

    This function is used to remove the air ideal load template blocks in an idf file
	
    :param IdealIDF: This is the path to an idf file contains air ideal load template.
	
    :param IdealPartIDF: This is the library of Air ideal load blocks in an IDF file
	
    :param fname: This is the new path to the new idf file without air ideal load template
	
    :return: This function returns nothing
	
	
	
###AddHvacPart(path, hvacpath)

    This function is used to add the HVAC part from the generated HVAC idf file
	
    :param path: This is the path to the final idf file (with air ideal load template removed and location updated)
	
    :param hvacpath: This is the path to the HVAC idf file
	
    :return: This function returns nothing


